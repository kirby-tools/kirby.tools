---
title: Global Configuration
description: Configure AI providers, API keys, models, and global defaults for the Kirby Copilot plugin.
---

Configure Kirby Copilot globally in your `config.php` file. This sets default configuration properties that apply to all plugin instances, including AI provider settings, generation parameters, and default behavior for view buttons and sections.

## AI Provider Configuration

Kirby Copilot supports multiple AI providers. You must configure at least one provider with valid credentials for the plugin to function.

::card-group

::card{title="OpenAI" icon="i-simple-icons-openai" to="https://platform.openai.com"}
GPT-5 and GPT-5 Mini models for content generation.
::

::card{title="Google" icon="i-simple-icons-google" to="https://aistudio.google.com/api-keys"}
Gemini models. Recommended for blocks and layout generation. Free tier available!
::

::card{title="Anthropic" icon="i-simple-icons-anthropic" to="https://console.anthropic.com"}
Claude models for nuanced content generation.
::

::card{title="Mistral" icon="i-simple-icons-mistralai" to="https://console.mistral.ai"}
European AI models with custom base URL support.
::

::

::note
For generating [Blocks and Layouts](/docs/copilot/advanced/blocks-and-layouts) or other structured data, we recommend Google Gemini models. Create a new [Google API key](https://aistudio.google.com/api-keys) and add it to the configuration along with the AI model such as Gemini 3 Flash. Usage is currently free!
::

### Basic Provider Setup

All provider configurations are nested under the `johannschopplich.copilot` key:

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'provider' => 'google', // Choose your primary provider
        'providers' => [
            'google' => [
                'apiKey' => 'YOUR_API_KEY',
                // Model for content generation
                'model' => 'gemini-3-pro-preview',
                // Model for writer field inline suggestions
                'completionModel' => 'gemini-3-flash-preview'
            ]
        ]
    ]
];
```

Each provider supports two model configurations:

- **`model`** – Used for content generation (text, blocks, layouts).
- **`completionModel`** – Used for inline suggestions in writer fields (should be fast and lightweight).

### Provider Examples

::code-group

```php [OpenAI]
return [
    'johannschopplich.copilot' => [
        'provider' => 'openai',
        'providers' => [
            'openai' => [
                'apiKey' => env('OPENAI_API_KEY'),
                'model' => 'gpt-5-mini'
            ]
        ]
    ]
];
```

```php [Google Gemini]
return [
    'johannschopplich.copilot' => [
        'provider' => 'google',
        'providers' => [
            'google' => [
                'apiKey' => env('GOOGLE_API_KEY'),
                'model' => 'gemini-3-pro-preview'
            ]
        ]
    ]
];
```

```php [Anthropic Claude]
return [
    'johannschopplich.copilot' => [
        'provider' => 'anthropic',
        'providers' => [
            'anthropic' => [
                'apiKey' => env('ANTHROPIC_API_KEY'),
                'model' => 'claude-sonnet-4-5-20250929'
            ]
        ]
    ]
];
```

```php [Mistral]
return [
    'johannschopplich.copilot' => [
        'provider' => 'mistral',
        'providers' => [
            'mistral' => [
                'apiKey' => env('MISTRAL_API_KEY'),
                'model' => 'mistral-large-latest',
                // Optional: custom base URL
                'baseUrl' => 'https://api.mistral.ai'
            ]
        ]
    ]
];
```

::

### Default Models

If you do not specify a `model` or `completionModel`, Kirby Copilot uses sensible defaults for each provider:

| Provider  | Generation Model (`model`)   | Completion Model (`completionModel`) |
| --------- | ---------------------------- | ------------------------------------ |
| OpenAI    | `gpt-5.2`                    | `gpt-5-nano`                         |
| Google    | `gemini-3-pro-preview`       | `gemini-3-flash-preview`             |
| Anthropic | `claude-sonnet-4-5-20250929` | `claude-haiku-4-5-20251001`          |
| Mistral   | `mistral-large-latest`       | `mistral-small-latest`               |

::tip
The `completionModel` is used for [inline suggestions](/docs/copilot/usage/inline-suggestions) in writer fields. It should be a fast, lightweight model optimized for quick inline suggestions.
::

## AI Generation Settings

### `systemPrompt` :u-badge{label="String" class="align-middle ml-2 rounded-full!" variant="subtle"}

Global system prompt that defines how the AI should structure and approach content generation. This can be overridden by view button props or section configuration.

Kirby Copilot ships with a well-crafted default system prompt that handles response formatting for different field types (text, markdown, rich-text) and preserves formatting when working with selected text. In most cases, the default works out of the box and customization is not necessary.

::callout{icon="i-ri-ai-generate" color="info" to="/docs/copilot/configuration/system-prompt"}
Learn more about the default system prompt and when to customize it.
::

### `excludedBlocks` :u-badge{label="Array" class="align-middle ml-2 rounded-full!" variant="subtle"}

Specify block types to exclude from structured data generation in [blocks and layout fields](/docs/copilot/advanced/blocks-and-layouts). This is useful for custom block types for which AI generation is not desired.

**Default:** `[]` (no blocks excluded)

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'excludedBlocks' => ['custom-form', 'widget', 'advertisement'],
    ]
];
```

### `reasoningEffort` :u-badge{label="String" class="align-middle ml-2 rounded-full!" variant="subtle"}

Controls the depth of reasoning applied during content generation. This property works with all reasoning-capable models across providers (GPT-5, Gemini 3, Claude 4).

**Default:** `low`  
**Options:** `none`, `low`, `medium`, `high`

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'reasoningEffort' => 'medium'
    ]
];
```

::note
Modern AI models are designed as reasoning models with different underlying architectures. The model manages creativity internally based on the reasoning effort level, making manual `temperature` configuration obsolete.
::

### `completion` :u-badge{label="Array | Boolean" class="align-middle ml-2 rounded-full!" variant="subtle"}

Controls inline suggestions in writer fields. Inline suggestions are enabled by default for all writer fields.

**Default:** `['debounce' => 1000]`

To disable inline suggestions globally:

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'completion' => false
    ]
];
```

To customize the debounce timing (minimum 500ms):

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'completion' => [
            'debounce' => 1500 // Wait 1.5 seconds after typing stops
        ]
    ]
];
```

::callout{icon="i-ri-ai-generate" color="info" to="/docs/copilot/usage/inline-suggestions"}
Learn more about inline suggestions behavior and keyboard shortcuts.
::

### `baseUrl` :u-badge{label="String" class="align-middle ml-2 rounded-full!" variant="subtle"}

Custom base URL for the AI provider API. This property is configured per provider alongside `apiKey` and `model`. Useful when using proxy services, custom API endpoints, or self-hosted AI services like llama.cpp.

**Default:** Provider-specific default URL

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'provider' => 'openai',
        'providers' => [
            'openai' => [
                'apiKey' => env('OPENAI_API_KEY'),
                'model' => 'llama-3.2-3b-instruct',
                'baseUrl' => 'https://llama.example.com/v1'
            ]
        ]
    ]
];
```

## Global Defaults

You can set global defaults that apply to both view buttons and sections. These can be overridden in individual blueprints.

### Available Global Defaults

For detailed descriptions of each property, see the [View Button & Section Configuration](/docs/copilot/configuration/local#available-properties) page. The following properties can be set globally:

::field-group

::field{name="systemPrompt" type="String"}
Default system prompt that controls how the AI structures and formats generated content across all view buttons and fields.
::

::field{name="userPrompt" type="String"}
Default user prompt that appears when generation dialogs open.
::

::field{name="logLevel" type="String"}
Default logging level for debugging AI generation. Options: `error`, `warn`, `info`, `debug`.
::

::

### Basic Global Configuration

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'provider' => 'google', // Primary provider
        'providers' => [
            'google' => [
                'apiKey' => env('GOOGLE_API_KEY'),
                'model' => 'gemini-3-pro-preview'
            ]
        ],

        // Global Defaults
        'logLevel' => 'info',
        'excludedBlocks' => ['custom-form']
    ]
];
```

## Security :u-badge{label="Improved in v3" class="align-middle mb-1 ml-2 rounded-full" variant="subtle"}

Starting with v3, all AI provider requests are routed through a server-side proxy. **Your API keys are no longer exposed in browser network requests**, protecting them from Panel users.

::tip
This is a significant security improvement over v2, where API keys were visible in client-side network requests. No additional configuration is required – the proxy is enabled automatically.
::

We still recommend following these best practices:

- Use environment variables for API keys.
- Create separate API keys for each project/client.
- Set usage limits on your AI provider accounts.
- Monitor API usage regularly.

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'providers' => [
            'openai' => [
                'apiKey' => env('OPENAI_API_KEY'), // Use environment variables
            ]
        ]
    ]
];
```

### Dynamic API Keys :u-badge{label="since v3.1.0" class="align-middle mb-1 ml-2 rounded-full" variant="subtle"}

For advanced use cases, you can provide a closure that resolves the API key dynamically at runtime. The closure receives the Kirby instance as its first argument, allowing user-specific or context-dependent API keys.

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'providers' => [
            'openai' => [
                'apiKey' => function (\Kirby\Cms\App $kirby) {
                    // Example: Return different keys based on user role
                    $user = $kirby->user();

                    if ($user?->role()->name() === 'admin') {
                        return env('OPENAI_API_KEY_ADMIN');
                    }

                    return env('OPENAI_API_KEY_USER');
                }
            ]
        ]
    ]
];
```

This is useful for scenarios like:

- Different API keys or rate limits per user role.
- Fetching keys from external services or databases.
- Multi-tenant setups with client-specific credentials.

## Configuration Precedence

Global configuration serves as the foundation, with more specific configurations overriding global defaults:

1. **Global configuration** (in `config.php`)
2. **Section configuration** (in blueprint sections) & **view button props** (in blueprint buttons)

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'logLevel' => 'warn',
        'systemPrompt' => 'Global prompt…'
    ]
];
```

```yaml [Blueprint Override]
sections:
  copilot:
    type: copilot
    field: content
    logLevel: debug # Overrides global
    # systemPrompt inherited from global

buttons:
  copilot:
    logLevel: debug # Overrides both global
```

## Complete Configuration Example

::code-collapse

```php [config.php]
return [
    'johannschopplich.copilot' => [
        'provider' => 'google', // Primary provider
        'providers' => [
            'google' => [
                'apiKey' => env('GOOGLE_API_KEY'),
                'model' => 'gemini-3-pro-preview',
                'completionModel' => 'gemini-3-flash-preview'
            ],
            'openai' => [
                'apiKey' => env('OPENAI_API_KEY'),
                'model' => 'gpt-5-mini',
                'completionModel' => 'gpt-5-nano'
            ]
        ],

        // Generation settings
        'reasoningEffort' => 'low',
        'completion' => [
            'debounce' => 1000
        ],

        // Global defaults
        'excludedBlocks' => [
            'contact-form',
            'newsletter-signup',
            'advertisement'
        ]
    ]
];
```

::
